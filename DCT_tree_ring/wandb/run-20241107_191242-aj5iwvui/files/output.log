/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/pipelines/pipeline_loading_utils.py:221: FutureWarning: You are loading the variant fp16 from stabilityai/stable-diffusion-2-1-base via `revision='fp16'` even though you can load it via `variant=`fp16`. Loading model variants via `revision='fp16'` is deprecated and will be removed in diffusers v1. Please use `variant='fp16'` instead.
  warnings.warn(
Loading pipeline components...:  20%|██████████████▊                                                           | 1/5 [00:01<00:07,  1.95s/it]An error occurred while trying to fetch /Users/navtegh/.cache/huggingface/hub/models--stabilityai--stable-diffusion-2-1-base/snapshots/1f758383196d38df1dfe523ddb1030f2bfab7741/unet: Error no file named diffusion_pytorch_model.safetensors found in directory /Users/navtegh/.cache/huggingface/hub/models--stabilityai--stable-diffusion-2-1-base/snapshots/1f758383196d38df1dfe523ddb1030f2bfab7741/unet.
Defaulting to unsafe serialization. Pass `allow_pickle=False` to raise an error instead.
Loading pipeline components...:  40%|█████████████████████████████▌                                            | 2/5 [00:07<00:13,  4.35s/it]An error occurred while trying to fetch /Users/navtegh/.cache/huggingface/hub/models--stabilityai--stable-diffusion-2-1-base/snapshots/1f758383196d38df1dfe523ddb1030f2bfab7741/vae: Error no file named diffusion_pytorch_model.safetensors found in directory /Users/navtegh/.cache/huggingface/hub/models--stabilityai--stable-diffusion-2-1-base/snapshots/1f758383196d38df1dfe523ddb1030f2bfab7741/vae.
Defaulting to unsafe serialization. Pass `allow_pickle=False` to raise an error instead.
Loading pipeline components...: 100%|██████████████████████████████████████████████████████████████████████████| 5/5 [00:08<00:00,  1.65s/it]
You have disabled the safety checker for <class 'inverse_stable_diffusion.InversableStableDiffusionPipeline'> by passing `safety_checker=None`. Ensure that you abide to the conditions of the Stable Diffusion license and do not expose unfiltered results in services or applications open to the public. Both the diffusers team and Hugging Face strongly recommend to keep the safety filter enabled in all public facing circumstances, disabling it only for use-cases that involve analyzing network behavior or auditing its results. For more information, please have a look at https://github.com/huggingface/diffusers/pull/254 .
/Users/navtegh/Documents/Watermarking-diffusion-models/inverse_stable_diffusion.py:63: FutureWarning: Accessing config attribute `in_channels` directly via 'UNet2DConditionModel' object attribute is deprecated. Please access 'in_channels' over 'UNet2DConditionModel's config object instead, e.g. 'unet.config.in_channels'.
  num_channels_latents = self.unet.in_channels
  0%|                                                                                                               | 0/1000 [00:00<?, ?it/s]/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py:303: FutureWarning: `_encode_prompt()` is deprecated and it will be removed in a future version. Use `encode_prompt()` instead. Also, be aware that the output format changed from a concatenated tensor to a tuple.
  deprecate("_encode_prompt()", "1.0.0", deprecation_message, standard_warn=False)
/Users/navtegh/Documents/Watermarking-diffusion-models/modified_stable_diffusion.py:140: FutureWarning: Accessing config attribute `in_channels` directly via 'UNet2DConditionModel' object attribute is deprecated. Please access 'in_channels' over 'UNet2DConditionModel's config object instead, e.g. 'unet.config.in_channels'.
  num_channels_latents = self.unet.in_channels
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:56<00:00,  7.14s/it]
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py:589: FutureWarning: The decode_latents method is deprecated and will be removed in 1.0.0. Please use VaeImageProcessor.postprocess(...) instead
  deprecate("decode_latents", "1.0.0", deprecation_message, standard_warn=False)
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:28<00:00,  6.57s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:28<00:00,  2.97s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:06<00:00,  2.52s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:15<00:00,  6.31s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:30<00:00,  6.61s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:17<00:00,  2.74s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:06<00:00,  2.52s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:00<00:00,  8.42s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:53<00:00,  9.47s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [03:05<00:00,  3.71s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:37<00:00,  3.15s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:39<00:00,  6.80s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:43<00:00,  6.87s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:24<00:00,  2.88s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:07<00:00,  2.54s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:27<00:00,  6.55s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:21<00:00,  6.42s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:13<00:00,  2.67s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:04<00:00,  2.49s/it]
  0%|▍                                                                                              | 5/1000 [1:28:16<289:28:05, 1047.32s/it]Token indices sequence length is longer than the specified maximum sequence length for this model (93 > 77). Running this sequence through the model will result in indexing errors
The following part of your input was truncated because CLIP can only handle sequences up to 77 tokens: ['morbacher , female , feminine , art deco , new baroque , intricate linework']
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:31<00:00,  6.62s/it]
The following part of your input was truncated because CLIP can only handle sequences up to 77 tokens: ['morbacher , female , feminine , art deco , new baroque , intricate linework']
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:08<00:00,  6.17s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:30<00:00,  3.01s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:56<00:00,  3.53s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:38<00:00,  9.18s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [06:04<00:00,  7.29s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:53<00:00,  3.47s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:56<00:00,  3.53s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:42<00:00,  9.25s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:55<00:00,  7.11s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:32<00:00,  3.06s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:17<00:00,  2.74s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [06:41<00:00,  8.02s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [06:50<00:00,  8.21s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:33<00:00,  3.06s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:25<00:00,  2.91s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [06:35<00:00,  7.90s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:45<00:00,  6.91s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:32<00:00,  3.04s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:27<00:00,  2.95s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:38<00:00,  6.76s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:21<00:00,  8.83s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:37<00:00,  3.15s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:32<00:00,  3.06s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:29<00:00,  8.98s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:44<00:00,  6.88s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:33<00:00,  3.07s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:06<00:00,  2.53s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:38<00:00,  6.77s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [05:23<00:00,  6.47s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:29<00:00,  3.00s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [02:00<00:00,  2.41s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [06:41<00:00,  8.04s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [07:43<00:00,  9.27s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [03:10<00:00,  3.80s/it]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [03:07<00:00,  3.75s/it]
  8%|████████▍                                                                                                | 4/50 [01:05<12:32, 16.35s/it]
  1%|█▎                                                                                            | 14/1000 [4:21:54<307:25:36, 1122.45s/it]
Traceback (most recent call last):
  File "/Users/navtegh/Documents/Watermarking-diffusion-models/run_tree_ring_watermark.py", line 230, in <module>
    main(args)
  File "/Users/navtegh/Documents/Watermarking-diffusion-models/run_tree_ring_watermark.py", line 68, in main
    outputs_no_w = pipe(
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/Users/navtegh/Documents/Watermarking-diffusion-models/modified_stable_diffusion.py", line 175, in __call__
    noise_pred = self.unet(latent_model_input, t, encoder_hidden_states=text_embeddings).sample
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/models/unets/unet_2d_condition.py", line 1226, in forward
    sample, res_samples = downsample_block(hidden_states=sample, temb=emb)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/models/unets/unet_2d_blocks.py", line 1391, in forward
    hidden_states = resnet(hidden_states, temb)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/diffusers/models/resnet.py", line 341, in forward
    hidden_states = self.conv1(hidden_states)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 457, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 453, in _conv_forward
    return F.conv2d(input, weight, bias, self.stride,
KeyboardInterrupt
